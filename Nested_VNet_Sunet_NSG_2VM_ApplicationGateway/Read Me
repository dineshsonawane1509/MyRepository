Please find the Nested (Linked) ARM for V-Net with 3 Subnets with NSG attached (Parent Template), 
Linked 2 VM in 2 different subnets and application gateway in third subnet.

Add Linked Template (VMs and Application Gateway) in Stoarage Account (Container), copy URLs and update in Parent Template (VNet).
